<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="app/fragments/head :: head"></head>
<body>
	<header><nav th:replace="app/fragments/menu :: menu"></nav></header>
	<div class="container-fluid">
	<form class="form" name="trxForm" th:object="${transaction}" th:action="@{/app/{bdgUUID}/accounts/{accUUID}/transaction(bdgUUID=${bdg.bdgUUID},accUUID=${acc.accUUID})}" method="post">

		<div th:replace="/app/fragments/hasErrors :: hasErrors"></div>
		<div th:replace="/app/fragments/hasMessage :: hasMessage"></div>
		<div id="ajaxErrors"></div>

		<div class="row flex-fill">

			<div th:replace="app/fragments/accountsNavigation :: accounts"></div>

			<div class="col-9">
			
				<div class="btn-toolbar mt-3" role="toolbar" aria-label="Toolbar with button groups">
					<div class="btn-group me-1" role="group">
						<button type="submit" name="SaveAndClose" class="btn btn-outline-primary btn-sm"><i class="bi bi-send-x"></i> Save and Close</button>
					</div>
					<div class="btn-group me-1" role="group">
						<button type="submit" name="SaveAndAddAnother" class="btn btn-outline-primary btn-sm"><i class="bi bi-send-plus"></i> Save and Add Another</button>
					</div>
					<div class="btn-group me-1" role="group">
						<button type="submit" name="Close" class="btn btn-outline-primary btn-sm"><i class="bi bi-x-circle"></i> Close</button>
					</div>
				</div>

				<div class="card bg-light mt-3">
					<div class="card-header py-2"><strong>Add Transaction</strong></div>
					<div class="card-body">
					
						<div class="row mb-2">
							<label for="trxDate" class="col-2 col-form-label">Date</label>
							<div class="col-3">
								<div class="input-group date">
									<input type="text" class="form-control" id="trxDate" name="trxDate" th:field="*{trxDate}" aria-describedby="basic-addon2" 
										th:attr="data-date-todayHighlight=true, data-date-language=${'en'}, data-date-format=${#strings.toLowerCase(bdg.bdgDateFormat.bdgdFormat)}">
										<!-- 
										TODO implements language 
										data-date=${#dates.format(transaction.trxDate, #strings.toLowerCase(bdg.bdgDateFormat.bdgdFormat))}
										--> 
									<span class="input-group-text" id="basic-addon2"><i class="bi bi-calendar3"></i></span>
								</div>
								<div class="invalid-feedback" th:if="${#fields.hasErrors('trxDate')}">
									<ul>
										<li th:each="err : ${#fields.errors('trxDate')}" th:text="${err}" />
									</ul>
								</div>
							</div>
						</div>
	
						<div class="row mb-2">
							<label for="trxPayee" class="col-2 col-form-label">Payee</label> 
							<div class="col-6">
								<select class="form-select" th:field="*{trxPayee}" th:errorclass="is-invalid">
									<option th:value="${null}" 
											th:text="${''}"></option>
									<optgroup label="Payments and Transfers:">
										<option th:each="pye : ${payeeTransferList}" 
												th:value="${pye.pyeUUID}" 
												th:text="${pye.pyeName}"></option>
									</optgroup>
									<optgroup label="Saved Payees:">
										<option th:each="pye : ${payeeUserList}" 
												th:value="${pye.pyeUUID}" 
												th:text="${pye.pyeName}"></option>
									</optgroup>
								</select>
								<div class="invalid-feedback" th:if="${#fields.hasErrors('trxPayee')}">
									<ul>
										<li th:each="err : ${#fields.errors('trxPayee')}" th:text="${err}" />
									</ul>
								</div>						
							</div>
						</div>
	
						<div class="row mb-2">
							<label for="trxCategory" class="col-2 col-form-label">Category</label> 
							<div class="col-6">
								<select class="form-select" th:field="*{trxCategory}" th:errorclass="is-invalid">
									<option th:value="${bdg.bdgCategoryUncategorized.catUUID}" 
											th:text="${''}"></option>
									<optgroup th:each="catg : ${catgInflowList}" th:attr="label=${catg.catgName}">
										<option th:each="cat : ${catList}" th:if="${cat.catCategoryGroup.catgName == catg.catgName}"
												th:value="${cat.catUUID}" 
												th:text="${cat.catName}">
										</option>
									</optgroup>
									<optgroup th:each="catg : ${catgOutflowList}" th:attr="label=${catg.catgName}">
										<option th:each="cat : ${catList}" th:if="${cat.catCategoryGroup.catgName == catg.catgName}"
												th:value="${cat.catUUID}" 
												th:text="${cat.catName}">
										</option>
									</optgroup>
								</select>
								<div class="invalid-feedback" th:if="${#fields.hasErrors('trxCategory')}">
									<ul>
										<li th:each="err : ${#fields.errors('trxCategory')}" th:text="${err}" />
									</ul>
								</div>						
							</div>
						</div>
	
						<div class="row mb-2">
							<label for="trxMemo" class="col-2 col-form-label">Memo</label>
							<div class="col-6">
								<input type="text" class="form-control" th:field="*{trxMemo}" th:errorclass="is-invalid">
								<div class="invalid-feedback" th:if="${#fields.hasErrors('trxMemo')}">
									<ul>
										<li th:each="err : ${#fields.errors('trxMemo')}" th:text="${err}" />
									</ul>
								</div>
							</div>
						</div>
	
						<div class="row mb-2">
							<label for="trxAmount" class="col-2 col-form-label">Amount</label>
							<div class="col-3">
								<div class="input-group">
									<input th:if="${bdg.bdgCurrencyPlacement == 0}" type="text" class="form-control" th:field="*{trxAmount}" th:errorclass="is-invalid"
										th:attr="data-inputmask=${'
											''alias'':''currency'', 
											''digits'':''__${bdg.bdgNumberFormat.bdgnDecimalDigits}__'',
											''radixPoint'':''__${bdg.bdgNumberFormat.bdgnDecimalSeparator}__'',
											''groupSeparator'':''__${bdg.bdgNumberFormat.bdgnGroupSeparator}__''
											'}">
									<input th:if="${bdg.bdgCurrencyPlacement == 1}" type="text" class="form-control" th:field="*{trxAmount}" th:errorclass="is-invalid"
										th:attr="data-inputmask=${'
											''alias'':''currency'', 
											''prefix'': ''__${bdg.bdgCurrency.ccySymbol}__ '', 
											''digits'':''__${bdg.bdgNumberFormat.bdgnDecimalDigits}__'',
											''radixPoint'':''__${bdg.bdgNumberFormat.bdgnDecimalSeparator}__'',
											''groupSeparator'':''__${bdg.bdgNumberFormat.bdgnGroupSeparator}__''
											'}">
									<input th:if="${bdg.bdgCurrencyPlacement == 2}" type="text" class="form-control" th:field="*{trxAmount}" th:errorclass="is-invalid"
										th:attr="data-inputmask=${'
											''alias'':''currency'', 
											''suffix'': '' __${bdg.bdgCurrency.ccySymbol}__'', 
											''digits'':''__${bdg.bdgNumberFormat.bdgnDecimalDigits}__'',
											''radixPoint'':''__${bdg.bdgNumberFormat.bdgnDecimalSeparator}__'',
											''groupSeparator'':''__${bdg.bdgNumberFormat.bdgnGroupSeparator}__''
											'}">
									<span class="input-group-text"><i class="bi bi-cash-coin"></i></span>
								</div>
								<div class="invalid-feedback" th:if="${#fields.hasErrors('trxAmount')}">
									<ul>
										<li th:each="err : ${#fields.errors('trxAmount')}" th:text="${err}" />
									</ul>
								</div>
							</div>
						</div>

						<div class="row mb-2">
							<label for="trxPayee" class="col-2 col-form-label">Cleared</label> 
							<div class="col-3">
								<select class="form-select" th:field="*{trxCleared}" th:errorclass="is-invalid">
									<option th:value="${0}" th:text="${'Uncleared'}"></option>
									<option th:value="${1}" th:text="${'Cleared'}"></option>
									<option th:value="${2}" th:text="${'Reconcilied'}"></option>
								</select>
								<div class="invalid-feedback" th:if="${#fields.hasErrors('trxCleared')}">
									<ul>
										<li th:each="err : ${#fields.errors('trxCleared')}" th:text="${err}" />
									</ul>
								</div>						
							</div>
						</div>




					</div>
				</div> <!-- card -->
				
			</div>
		</div>
	</form>
	</div>

	<div th:replace="app/fragments/script :: script">...</div>
	<div th:replace="app/fragments/script_input :: script">...</div>
	
	<script th:inline="javascript">
        $(document).ready(function () {
        	
            $('#trxDate').datepicker({
            	todayBtn: "linked",
            	autoclose: true
			});
        });
	</script>

	<!--  
	var message = /*[[${message}]]*/ 'default';
    console.log(message);

    <script>
        $(document).ready(function () {
            $('#trxDate').datepicker({
    		    format: "mm/yyyy",
    		    startView: 1,
    		    minViewMode: 1,
    		    maxViewMode: 2
            });
        });
    </script> 
	-->
	
	
</body>
</html>